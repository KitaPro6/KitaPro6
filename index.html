<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Demo Kindergarten-Bibliothek</title>
  <style>
    body { font-family: sans-serif; background: #f6f6ff; }
    .hidden { display: none; }
    .neu-badge { color: #e88; background: #fff4ee; border-radius: 6px; font-weight: bold; font-size: 13px; margin-left: 8px; padding: 1px 6px; border: 1px solid #e6b; vertical-align: middle; }
  </style>
</head>
<body>
  <h1>📚 Kindergarten-Bibliothek</h1>
  <button onclick="showAdminLogin()">🔑 Admin</button>
  <div id="admin-login" class="hidden">
    <input type="password" id="admin-pw" placeholder="Passwort">
    <button onclick="checkAdmin()">Login</button>
  </div>
  <div id="admin-panel" class="hidden">
    <button onclick="logoutAdmin()">Logout</button>
  </div>
  <div id="new-books"></div>
  <div id="modal" class="hidden">
    <div id="modal-content"></div>
  </div>
  <script>
    let books = [
      {
        id: "B-100",
        title: "Das neue Märchenbuch",
        isNew: true,
        newSince: new Date().toISOString(),
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a0/The_Great_Gatsby_cover_1925_%281%29.jpg/200px-The_Great_Gatsby_cover_1925_%281%29.jpg",
        description: "Ein schönes Buch über Fantasie.",
      }
    ];
    let adminMode = false;

    function showAdminLogin() {
      document.getElementById("admin-login").classList.remove("hidden");
      document.getElementById("admin-panel").classList.add("hidden");
      adminMode = false;
    }
    function checkAdmin() {
      const pw = document.getElementById("admin-pw").value;
      if (pw === "Märchenschloss2025") {
        adminMode = true;
        document.getElementById("admin-login").classList.add("hidden");
        document.getElementById("admin-panel").classList.remove("hidden");
        renderNewBooks();
      } else {
        alert("❌ Falsches Passwort");
        document.getElementById("admin-pw").value = "";
      }
    }
    function logoutAdmin() {
      adminMode = false;
      document.getElementById("admin-login").classList.remove("hidden");
      document.getElementById("admin-panel").classList.add("hidden");
      renderNewBooks();
    }

    function renderNewBooks() {
      const container = document.getElementById("new-books");
      const now = Date.now();
      const sixWeeksMs = 6 * 7 * 24 * 60 * 60 * 1000;
      books.forEach(b => {
        if (b.isNew && b.newSince && (now - new Date(b.newSince).getTime() > sixWeeksMs)) {
          b.isNew = false;
          b.newSince = "";
        }
      });
      const newBooks = books.filter(b =>
        b.isNew &&
        b.newSince &&
        (now - new Date(b.newSince).getTime() <= sixWeeksMs)
      );
      if (newBooks.length === 0) {
        container.innerHTML = "";
        return;
      }
      container.innerHTML = `
        <div style="background:#fffbcc;border-radius:8px;padding:10px;margin-bottom:12px;">
          <strong>✨ Neue Bücher:</strong>
          <div style="display:flex;flex-wrap:wrap;gap:18px;margin-top:10px;">
            ${newBooks.map(b => `
              <div style="width:140px;text-align:center;">
                <div>
                  ${b.img ? `<img src="${b.img}" style="width:70px;height:100px;object-fit:cover;border-radius:6px; border:1px solid #e6b;cursor:pointer;" onclick="showImageModal(0)">` : ""}
                </div>
                <div style="margin:5px 0 0 0;font-size:15px;">
                  ${b.id} – ${b.title}
                  <span class="neu-badge">Neu!</span>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      `;
    }

    function showImageModal(index) {
      const book = books[index];
      let modalHtml = `<div style="text-align:center;">`;
      if (book.img) {
        modalHtml += `<img src="${book.img}" style="max-width:90vw;max-height:60vh;border-radius:10px;box-shadow:0 0 16px #999;"><br><br>`;
      }
      if (adminMode) {
        modalHtml += `
          <textarea id="book-desc" style="width:90%;height:80px;padding:8px;border-radius:7px;" placeholder="Beschreibung eingeben...">${book.description || ''}</textarea><br>
          <button onclick="saveDescription(${index})">💾 Beschreibung speichern</button>
        `;
      } else if (book.description) {
        modalHtml += `<div style="margin-top:10px;color:#333;background:#f9f9ef;padding:12px;border-radius:7px;">${book.description}</div>`;
      }
      modalHtml += `<br><button onclick="closeModal()">Schließen</button></div>`;
      document.getElementById("modal-content").innerHTML = modalHtml;
      document.getElementById("modal").classList.remove("hidden");
    }
    function saveDescription(index) {
      books[index].description = document.getElementById("book-desc").value;
      closeModal();
      renderNewBooks();
    }
    function closeModal() {
      document.getElementById("modal").classList.add("hidden");
    }

    // Initiales Rendering
    renderNewBooks();
  </script>
</body>
</html>
